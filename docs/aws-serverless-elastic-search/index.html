<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AWS serverless search application | A chitchat about new learnings</title><meta name=keywords content="AWS"><meta name=description content="How to build a search application with Amazon Opensearch Serverless, Dynamodb and AWS lambda in a serverless manner"><meta name=author content="Nabila Farzana"><link rel=canonical href=https://Nabila-Farzana.github.io/ThevinchisNotebook/docs/aws-serverless-elastic-search/><link crossorigin=anonymous href=/ThevinchisNotebook/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/ThevinchisNotebook/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://Nabila-Farzana.github.io/ThevinchisNotebook/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://Nabila-Farzana.github.io/ThevinchisNotebook/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://Nabila-Farzana.github.io/ThevinchisNotebook/favicon-32x32.png><link rel=apple-touch-icon href=https://Nabila-Farzana.github.io/ThevinchisNotebook/apple-touch-icon.png><link rel=mask-icon href=https://Nabila-Farzana.github.io/ThevinchisNotebook/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="AWS serverless search application"><meta property="og:description" content="How to build a search application with Amazon Opensearch Serverless, Dynamodb and AWS lambda in a serverless manner"><meta property="og:type" content="article"><meta property="og:url" content="https://Nabila-Farzana.github.io/ThevinchisNotebook/docs/aws-serverless-elastic-search/"><meta property="og:image" content="https://Nabila-Farzana.github.io/ThevinchisNotebook/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="docs"><meta property="article:published_time" content="2020-09-15T11:30:03+00:00"><meta property="article:modified_time" content="2020-09-15T11:30:03+00:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://Nabila-Farzana.github.io/ThevinchisNotebook/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="AWS serverless search application"><meta name=twitter:description content="How to build a search application with Amazon Opensearch Serverless, Dynamodb and AWS lambda in a serverless manner"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Docs","item":"https://Nabila-Farzana.github.io/ThevinchisNotebook/docs/"},{"@type":"ListItem","position":2,"name":"AWS serverless search application","item":"https://Nabila-Farzana.github.io/ThevinchisNotebook/docs/aws-serverless-elastic-search/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AWS serverless search application","name":"AWS serverless search application","description":"How to build a search application with Amazon Opensearch Serverless, Dynamodb and AWS lambda in a serverless manner","keywords":["AWS"],"articleBody":"The backstory I was involved in a project focused on developing a fleet management system. One of the core functionalities of this system was the ability to search for available trips through a public API. Initially, we implemented this search feature using DynamoDB’s query operation. However, we encountered a significant limitation with this approach. DynamoDB’s query operation has a strict constraint: it can retrieve a maximum of 1 MB of data, and this limit is enforced before the filter expression is applied. As our data volume increased, this limitation became problematic, as our system couldn’t locate trips that fell outside of that 1 MB data limit. To address this challenge, our solution was to implement AWS Serverless OpenSearch. We are using Dynamodb as database and AWS lambda for handling logics.\nIn this post I will demonstrate how I built a simple web based seach application using the Amazon OpenSearch Serverless .\nA visual representation that illustrates the sequence of steps for better comprehension. The implementation flow in a nutshell A DynamoDB stream is an ordered flow of information about changes to items in a DynamoDB table. When you enable a stream on a table, DynamoDB captures information about every modification to data items in the table. In practical terms, whenever a new trip is generated or any modifications are made to trip-related information, the DynamoDB stream associated with the trip table sends this data to a designated AWS Lambda function, known as ddb_stream_to_es. This Lambda function serves as a chanel, forwarding the data to the AWS Serverless OpenSearch service. In essence, this setup ensures that all trip-related data flows seamlessly into an ElasticSearch index through this orchestrated process.\nTo facilitate searching within the system, I’ve developed an additional AWS Lambda function named search trip. This Lambda function is responsible for executing queries on the ElasticSearch index, seeking the desired trip-related information. And this lambda will be triggerd by an appsync API.\nCertainly, this is an overview of the system. Now, allow me to describe the implementation process, breaking it down into individual steps.\nStep-1: Create a collection in Opensearch Serverless A collection in Amazon OpenSearch Serverless is a logical grouping of one or more indexes that represent an analytics workload.\nBefore you proceed with the creation of your collection, ensure that you include the following policies in your IAM role:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Action\": [ \"aoss:CreateCollection\", \"aoss:ListCollections\", \"aoss:BatchGetCollection\", \"aoss:DeleteCollection\", \"aoss:CreateAccessPolicy\", \"aoss:ListAccessPolicies\", \"aoss:UpdateAccessPolicy\", \"aoss:CreateSecurityPolicy\", \"iam:ListUsers\", \"iam:ListRoles\", \"aoss:GetAccessPolicy\", \"aoss:CreateSecurityPolicy\", \"aoss:ListSecurityPolicies\", \"aoss:GetSecurityPolicy\", \"aoss:UpdateSecurityPolicy\", \"aoss:DeleteSecurityPolicy\", \"aoss:GetPoliciesStats\", \"aoss:GetAccountSettings\", \"aoss:UpdateAccountSettings\", \"iam:CreateServiceLinkedRole\", \"aoss:APIAccessAll\", \"aoss:DashboardsAccessAll\" ], \"Effect\": \"Allow\", \"Resource\": \"*\" } ] } I am using AWS Management Console to create the collection Next, we need to define the data access policy : Data access policies help you manage collections at scale by automatically assigning access permissions to collections and indexes that match a specific pattern.\nAnd now we need to click submit button and a brand new collection is created with a dashboard url Once the collection is created, then opensearch will provide an endpoint . You can retrive data by quering through this provided endpoint.\nNow when you click on the dashboard url you will be redirected to the Opensearch Dashboard. OpenSearch Dashboard is the user interface that lets you visualize your OpenSearch data and run and scale your OpenSearch clusters.OpenSearch Dashboards is a community-driven project forked from Kibana and is distributed under the Apache License 2.0, which is an open-source license.\nLog in to the dashboard using your AWS credential and create an index named trip-index using the following command in Dev tools:\n1 2 3 4 5 6 7 8 9 PUT trip-index { \"mappings\": { \"properties\": { \"id\": { \"type\" : \"keyword\" }, \"trip_start_date_time\": { \"type\" : \"date\", \"format\" : \"strict_date_time_no_millis\" } } } } Here you can find the mapping details.\nA crucial point to emphasize is that if you require exact, strict matching for a field (without partial matching), you must define the field type as “keyword.”\nFollowing the execution of this command, an index will be created, and the next step is to populate it with trip data, which will serve as the source for our trip searches.\nStep-2: Our next step involves transmitting data from the trip table, utilizing DynamoDB DataStream, to populate the OpenSearch trip-index. We will now activate the DynamoDB table stream for the trip table and configure the DDB_stream_to_ES Lambda function as its trigger. We must grant permissions for the DynamoDB stream to the DDB_stream_to_ES Lambda function and incorporate the following code to insert trip data into the OpenSearch index.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 import boto3 import requests from requests_aws4auth import AWS4Auth import json INDEX = 'trip-index' OPENSEARCH_ENDPOINT = 'Endpoint provided by opensearch' REGION = 'eu-east-1' // your region SERVICE = 'aoss' def format_document(document, key): value = '' if document.get(key) is not None: if key == 'is_published': value= document[key]['BOOL'] elif key == 'price': value= document[key]['N'] else: value= document[key]['S'] return value def lambda_handler(event, context): try: credentials = boto3.Session().get_credentials() awsauth = AWS4Auth(credentials.access_key, credentials.secret_key, REGION, SERVICE, session_token=credentials.token) datatype = '_doc' url = OPENSEARCH_ENDPOINT + '/' + INDEX + '/' + datatype + '/' headers = { \"Content-Type\": \"application/json\" } count = 0 for record in event['Records']: # Get the primary key for use as the Elasticsearch ID id = record['dynamodb']['Keys']['id']['S'] if record['eventName'] == 'REMOVE': r = requests.delete(url + id, auth=awsauth) print(\"delet item: \", r.json()) else: document = record['dynamodb']['NewImage'] document_to_insert = { 'id': format_document(document, 'id'), 'trip_name': format_document(document, 'trip_name'), 'start_location': format_document(document, 'start_location'), 'trip_start_date_time': format_document(document, 'trip_start_date_time'), 'end_location': format_document(document, 'start_location'), 'price': format_document(document, 'price'), 'is_published': format_document(document, 'is_published') } r = requests.put(url + id, auth=awsauth, json=document_to_insert, headers=headers) count += 1 return str(count) + ' records processed.' except Exception as err: print(\"Dynamodb stream into opensearch Exception = \",err) Step-3: Create a Lambda function for conducting trip searches within OpenSearch. The final task involves crafting an additional Lambda function, named “search_trip,” to execute queries on the OpenSearch trip-index to find the desired trips. This lambda will be triggered by an appsync query.\nIn search_trip lambda, we are utilizing Query DSL to perform queries on the “trip_index.”.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 import boto3 from boto3.dynamodb.conditions import Key, Attr import requests from requests_aws4auth import AWS4Auth import json INDEX = 'trip_index' OPENSEARCH_ENDPOINT = 'Endpoint provided by opensearch' REGION = 'eu-east-1' SERVICE = 'aoss' def lambda_handler(event, context): try: credentials = boto3.Session().get_credentials() awsauth = AWS4Auth(credentials.access_key, credentials.secret_key, REGION, SERVICE, session_token=credentials.token) search_url = OPENSEARCH_ENDPOINT + '/' + INDEX + '/_search' headers = { \"Content-Type\": \"application/json\" } search_query= event['arguments']['input'] query_string= search_query.get('query_string') from_date= search_query.get('from_date') to_date= search_query.get('to_date') page= search_query.get('page', 1) limit= search_query.get('limit', 25) start = (page - 1) * limit trip_to_retrieve = [] if limit \u003e 100: return 'Limit Can not be more than 100 !' query = { \"from\": start, \"size\": limit, \"query\": { \"bool\":{ \"must\":[ { \"match\":{ \"is_published\":true } }, { \"multi_match\":{ \"query\":query_string, \"fields\":[ \"id\", \"trip_name\", \"strat_location\", \"end_location\", \"price\" ] } }, { \"range\": { \"trip_start_date_time\": { \"gte\": from_date, \"lte\": to_date } } } ] } }, \"sort\": [ { \"trip_start_date_time\": { \"order\": \"desc\" } } ] } # Make the signed HTTP request r = requests.get(search_url, auth=awsauth, headers=headers, data=json.dumps(query)) search_result = r.json() total= search_result.get('hits').get('total')['value'] if total \u003e 0: items = search_result.get('hits').get('hits') search_response = { 'total': search_result.get('hits').get('total')['value'], 'items': items } return search_response except Exception as err: print(\"Search Trip Exception = \",err) With Query DSL, we have the capability to incorporate pagination through the “from” and “size” properties, arrange data in both ascending and descending orders using the “sort” property, and perform queries within a specified date range using the “range” property.\nAnd last but not the least, it’s essential to remember that you should include the “ddb_stream_to_es” and “search_trip” lambda roles, as well as your IAM user role, in the OpenSearch data access policy to enable access and perform CRUD (Create, Read, Update, Delete) operations on indexes within the specified collection.\nThank you for your patience!! I hope you found this article useful. Happy reading! ","wordCount":"1471","inLanguage":"en","datePublished":"2020-09-15T11:30:03Z","dateModified":"2020-09-15T11:30:03Z","author":{"@type":"Person","name":"Nabila Farzana"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://Nabila-Farzana.github.io/ThevinchisNotebook/docs/aws-serverless-elastic-search/"},"publisher":{"@type":"Organization","name":"A chitchat about new learnings","logo":{"@type":"ImageObject","url":"https://Nabila-Farzana.github.io/ThevinchisNotebook/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://Nabila-Farzana.github.io/ThevinchisNotebook/ accesskey=h title="A chitchat about new learnings (Alt + H)">A chitchat about new learnings</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://Nabila-Farzana.github.io/ThevinchisNotebook/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://Nabila-Farzana.github.io/ThevinchisNotebook/>Home</a>&nbsp;»&nbsp;<a href=https://Nabila-Farzana.github.io/ThevinchisNotebook/docs/>Docs</a></div><h1 class=post-title>AWS serverless search application</h1><div class=post-description>How to build a search application with Amazon Opensearch Serverless, Dynamodb and AWS lambda in a serverless manner</div><div class=post-meta><span title='2020-09-15 11:30:03 +0000 UTC'>September 15, 2020</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1471 words&nbsp;·&nbsp;Nabila Farzana&nbsp;|&nbsp;<a href=https://github.com/Nabila-Farzana/ThevinchisNotebook/blob/main/content//docs/aws-serverless-elastic-search/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h3 id=the-backstory>The backstory<a hidden class=anchor aria-hidden=true href=#the-backstory>#</a></h3><p>I was involved in a project focused on developing a fleet management system. One of the core functionalities of this system was the ability to search for available trips through a public API. Initially, we implemented this search feature using DynamoDB&rsquo;s query operation. However, we encountered a significant limitation with this approach. DynamoDB&rsquo;s query operation has a strict constraint: it can retrieve a maximum of 1 MB of data, and this limit is enforced before the filter expression is applied. As our data volume increased, this limitation became problematic, as our system couldn&rsquo;t locate trips that fell outside of that 1 MB data limit. To address this challenge, our solution was to implement AWS Serverless OpenSearch. We are using Dynamodb as database and AWS lambda for handling logics.</p><p>In this post I will demonstrate how I built a simple web based seach application using the <a href=https://docs.aws.amazon.com/opensearch-service/latest/developerguide/serverless-overview.html>Amazon OpenSearch Serverless </a>.</p><h3 id=a-visual-representation-that-illustrates-the-sequence-of-steps-for-better-comprehension>A visual representation that illustrates the sequence of steps for better comprehension.<a hidden class=anchor aria-hidden=true href=#a-visual-representation-that-illustrates-the-sequence-of-steps-for-better-comprehension>#</a></h3><p><img loading=lazy src=images/opensearch_implementation.webp alt="The implementation diagram"></p><h3 id=the-implementation-flow-in-a-nutshell>The implementation flow in a nutshell<a hidden class=anchor aria-hidden=true href=#the-implementation-flow-in-a-nutshell>#</a></h3><p>A DynamoDB stream is an ordered flow of information about changes to items in a DynamoDB table. When you enable a stream on a table, DynamoDB captures information about every modification to data items in the table.
In practical terms, whenever a new trip is generated or any modifications are made to trip-related information, the DynamoDB stream associated with the <strong>trip table</strong> sends this data to a designated AWS Lambda function, known as <strong>ddb_stream_to_es.</strong> This Lambda function serves as a chanel, forwarding the data to the AWS Serverless OpenSearch service. In essence, this setup ensures that all trip-related data flows seamlessly into an ElasticSearch index through this orchestrated process.</p><p>To facilitate searching within the system, I&rsquo;ve developed an additional AWS Lambda function named <strong>search trip</strong>. This Lambda function is responsible for executing queries on the ElasticSearch index, seeking the desired trip-related information. And this lambda will be triggerd by an appsync API.</p><p>Certainly, this is an overview of the system. Now, allow me to describe the implementation process, breaking it down into individual steps.</p><h3 id=step-1-create-a-collection-in-opensearch-serverless>Step-1: Create a collection in Opensearch Serverless<a hidden class=anchor aria-hidden=true href=#step-1-create-a-collection-in-opensearch-serverless>#</a></h3><p>A <a href=https://docs.aws.amazon.com/opensearch-service/latest/developerguide/serverless-manage.html>collection</a> in Amazon OpenSearch Serverless is a logical grouping of one or more indexes that represent an analytics workload.</p><p>Before you proceed with the creation of your collection, ensure that you include the following policies in your IAM role:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22>22</a>
</span><span class=lnt id=hl-0-23><a class=lnlinks href=#hl-0-23>23</a>
</span><span class=lnt id=hl-0-24><a class=lnlinks href=#hl-0-24>24</a>
</span><span class=lnt id=hl-0-25><a class=lnlinks href=#hl-0-25>25</a>
</span><span class=lnt id=hl-0-26><a class=lnlinks href=#hl-0-26>26</a>
</span><span class=lnt id=hl-0-27><a class=lnlinks href=#hl-0-27>27</a>
</span><span class=lnt id=hl-0-28><a class=lnlinks href=#hl-0-28>28</a>
</span><span class=lnt id=hl-0-29><a class=lnlinks href=#hl-0-29>29</a>
</span><span class=lnt id=hl-0-30><a class=lnlinks href=#hl-0-30>30</a>
</span><span class=lnt id=hl-0-31><a class=lnlinks href=#hl-0-31>31</a>
</span><span class=lnt id=hl-0-32><a class=lnlinks href=#hl-0-32>32</a>
</span><span class=lnt id=hl-0-33><a class=lnlinks href=#hl-0-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Version&#34;</span><span class=p>:</span> <span class=s2>&#34;2012-10-17&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Statement&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:CreateCollection&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:ListCollections&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:BatchGetCollection&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:DeleteCollection&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:CreateAccessPolicy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:ListAccessPolicies&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:UpdateAccessPolicy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:CreateSecurityPolicy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;iam:ListUsers&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;iam:ListRoles&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:GetAccessPolicy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:CreateSecurityPolicy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:ListSecurityPolicies&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:GetSecurityPolicy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:UpdateSecurityPolicy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:DeleteSecurityPolicy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:GetPoliciesStats&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:GetAccountSettings&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:UpdateAccountSettings&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;iam:CreateServiceLinkedRole&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:APIAccessAll&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;aoss:DashboardsAccessAll&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>I am using <a href=https://aws.amazon.com/console/>AWS Management Console</a> to create the collection
<img loading=lazy src=images/create_collection1.webp alt="Create collection"></p><p>Next, we need to define the data access policy :
<a href=https://docs.aws.amazon.com/opensearch-service/latest/developerguide/serverless-data-access.html>Data access policies</a> help you manage collections at scale by automatically assigning access permissions to collections and indexes that match a specific pattern.</p><p><img loading=lazy src=images/data_access.webp alt="Data access to create collection"></p><p><img loading=lazy src=images/configure_data_access.webp alt="Configure data access"></p><p><img loading=lazy src=images/review.webp alt="Riview data access"></p><p>And now we need to click submit button and a brand new collection is created with a dashboard url
<img loading=lazy src=images/create.webp alt="Configure data access"></p><p>Once the collection is created, then opensearch will provide an endpoint . You can retrive data by quering through this provided endpoint.</p><p>Now when you click on the dashboard url you will be redirected to the Opensearch Dashboard. <a href=https://opensearch.org/docs/latest/dashboards/index/>OpenSearch Dashboard</a> is the user interface that lets you visualize your OpenSearch data and run and scale your OpenSearch clusters.OpenSearch Dashboards is a community-driven project forked from Kibana and is distributed under the Apache License 2.0, which is an open-source license.</p><p>Log in to the dashboard using your AWS credential and create an index named trip-index using the following command in <a href="https://opensearch.org/docs/latest/dashboards/dev-tools/index-dev/#:~:text=Use%20Dev%20Tools%20to%20set,the%20OpenSearch%20Dashboards%20home%20page.">Dev tools</a>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    PUT trip-index
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        &#34;mappings&#34;: {
</span></span><span class=line><span class=cl>            &#34;properties&#34;: {
</span></span><span class=line><span class=cl>            &#34;id&#34;:    { &#34;type&#34; : &#34;keyword&#34; },
</span></span><span class=line><span class=cl>            &#34;trip_start_date_time&#34;: { &#34;type&#34; : &#34;date&#34;,  &#34;format&#34; : &#34;strict_date_time_no_millis&#34; }
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span></code></pre></td></tr></table></div></div><p><a href=https://opensearch.org/docs/2.5/field-types/mappings/>Here</a> you can find the mapping details.</p><p><strong>A crucial point to emphasize is that if you require exact, strict matching for a field (without partial matching), you must define the field type as &ldquo;keyword.&rdquo;</strong></p><p>Following the execution of this command, an index will be created, and the next step is to populate it with trip data, which will serve as the source for our trip searches.</p><h3 id=step-2-our-next-step-involves-transmitting-data-from-the-trip-table-utilizing-dynamodb-datastream-to-populate-the-opensearch-trip-index>Step-2: Our next step involves transmitting data from the trip table, utilizing DynamoDB DataStream, to populate the OpenSearch trip-index.<a hidden class=anchor aria-hidden=true href=#step-2-our-next-step-involves-transmitting-data-from-the-trip-table-utilizing-dynamodb-datastream-to-populate-the-opensearch-trip-index>#</a></h3><p>We will now activate the DynamoDB table stream for the trip table and configure the DDB_stream_to_ES Lambda function as its trigger.
<img loading=lazy src=images/db_stream.webp alt="Turn on stream "></p><p>We must grant permissions for the DynamoDB stream to the DDB_stream_to_ES Lambda function and incorporate the following code to insert trip data into the OpenSearch index.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span><span class=lnt id=hl-2-27><a class=lnlinks href=#hl-2-27>27</a>
</span><span class=lnt id=hl-2-28><a class=lnlinks href=#hl-2-28>28</a>
</span><span class=lnt id=hl-2-29><a class=lnlinks href=#hl-2-29>29</a>
</span><span class=lnt id=hl-2-30><a class=lnlinks href=#hl-2-30>30</a>
</span><span class=lnt id=hl-2-31><a class=lnlinks href=#hl-2-31>31</a>
</span><span class=lnt id=hl-2-32><a class=lnlinks href=#hl-2-32>32</a>
</span><span class=lnt id=hl-2-33><a class=lnlinks href=#hl-2-33>33</a>
</span><span class=lnt id=hl-2-34><a class=lnlinks href=#hl-2-34>34</a>
</span><span class=lnt id=hl-2-35><a class=lnlinks href=#hl-2-35>35</a>
</span><span class=lnt id=hl-2-36><a class=lnlinks href=#hl-2-36>36</a>
</span><span class=lnt id=hl-2-37><a class=lnlinks href=#hl-2-37>37</a>
</span><span class=lnt id=hl-2-38><a class=lnlinks href=#hl-2-38>38</a>
</span><span class=lnt id=hl-2-39><a class=lnlinks href=#hl-2-39>39</a>
</span><span class=lnt id=hl-2-40><a class=lnlinks href=#hl-2-40>40</a>
</span><span class=lnt id=hl-2-41><a class=lnlinks href=#hl-2-41>41</a>
</span><span class=lnt id=hl-2-42><a class=lnlinks href=#hl-2-42>42</a>
</span><span class=lnt id=hl-2-43><a class=lnlinks href=#hl-2-43>43</a>
</span><span class=lnt id=hl-2-44><a class=lnlinks href=#hl-2-44>44</a>
</span><span class=lnt id=hl-2-45><a class=lnlinks href=#hl-2-45>45</a>
</span><span class=lnt id=hl-2-46><a class=lnlinks href=#hl-2-46>46</a>
</span><span class=lnt id=hl-2-47><a class=lnlinks href=#hl-2-47>47</a>
</span><span class=lnt id=hl-2-48><a class=lnlinks href=#hl-2-48>48</a>
</span><span class=lnt id=hl-2-49><a class=lnlinks href=#hl-2-49>49</a>
</span><span class=lnt id=hl-2-50><a class=lnlinks href=#hl-2-50>50</a>
</span><span class=lnt id=hl-2-51><a class=lnlinks href=#hl-2-51>51</a>
</span><span class=lnt id=hl-2-52><a class=lnlinks href=#hl-2-52>52</a>
</span><span class=lnt id=hl-2-53><a class=lnlinks href=#hl-2-53>53</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>requests_aws4auth</span> <span class=kn>import</span> <span class=n>AWS4Auth</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>INDEX</span> <span class=o>=</span> <span class=s1>&#39;trip-index&#39;</span>
</span></span><span class=line><span class=cl><span class=n>OPENSEARCH_ENDPOINT</span> <span class=o>=</span> <span class=s1>&#39;Endpoint provided by opensearch&#39;</span>
</span></span><span class=line><span class=cl><span class=n>REGION</span> <span class=o>=</span> <span class=s1>&#39;eu-east-1&#39;</span> <span class=o>//</span> <span class=n>your</span> <span class=n>region</span>
</span></span><span class=line><span class=cl><span class=n>SERVICE</span> <span class=o>=</span> <span class=s1>&#39;aoss&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>format_document</span><span class=p>(</span><span class=n>document</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>value</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>document</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>key</span> <span class=o>==</span> <span class=s1>&#39;is_published&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>value</span><span class=o>=</span> <span class=n>document</span><span class=p>[</span><span class=n>key</span><span class=p>][</span><span class=s1>&#39;BOOL&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>key</span> <span class=o>==</span> <span class=s1>&#39;price&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>value</span><span class=o>=</span> <span class=n>document</span><span class=p>[</span><span class=n>key</span><span class=p>][</span><span class=s1>&#39;N&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>value</span><span class=o>=</span> <span class=n>document</span><span class=p>[</span><span class=n>key</span><span class=p>][</span><span class=s1>&#39;S&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>lambda_handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>credentials</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span><span class=o>.</span><span class=n>get_credentials</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>awsauth</span> <span class=o>=</span> <span class=n>AWS4Auth</span><span class=p>(</span><span class=n>credentials</span><span class=o>.</span><span class=n>access_key</span><span class=p>,</span> <span class=n>credentials</span><span class=o>.</span><span class=n>secret_key</span><span class=p>,</span> <span class=n>REGION</span><span class=p>,</span> <span class=n>SERVICE</span><span class=p>,</span> <span class=n>session_token</span><span class=o>=</span><span class=n>credentials</span><span class=o>.</span><span class=n>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>datatype</span> <span class=o>=</span> <span class=s1>&#39;_doc&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=n>OPENSEARCH_ENDPOINT</span> <span class=o>+</span> <span class=s1>&#39;/&#39;</span> <span class=o>+</span> <span class=n>INDEX</span> <span class=o>+</span> <span class=s1>&#39;/&#39;</span> <span class=o>+</span> <span class=n>datatype</span> <span class=o>+</span> <span class=s1>&#39;/&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>record</span> <span class=ow>in</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;Records&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Get the primary key for use as the Elasticsearch ID</span>
</span></span><span class=line><span class=cl>            <span class=nb>id</span> <span class=o>=</span> <span class=n>record</span><span class=p>[</span><span class=s1>&#39;dynamodb&#39;</span><span class=p>][</span><span class=s1>&#39;Keys&#39;</span><span class=p>][</span><span class=s1>&#39;id&#39;</span><span class=p>][</span><span class=s1>&#39;S&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>record</span><span class=p>[</span><span class=s1>&#39;eventName&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;REMOVE&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>url</span> <span class=o>+</span> <span class=nb>id</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=n>awsauth</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;delet item: &#34;</span><span class=p>,</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>document</span> <span class=o>=</span> <span class=n>record</span><span class=p>[</span><span class=s1>&#39;dynamodb&#39;</span><span class=p>][</span><span class=s1>&#39;NewImage&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>document_to_insert</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=n>format_document</span><span class=p>(</span><span class=n>document</span><span class=p>,</span> <span class=s1>&#39;id&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;trip_name&#39;</span><span class=p>:</span> <span class=n>format_document</span><span class=p>(</span><span class=n>document</span><span class=p>,</span> <span class=s1>&#39;trip_name&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;start_location&#39;</span><span class=p>:</span> <span class=n>format_document</span><span class=p>(</span><span class=n>document</span><span class=p>,</span> <span class=s1>&#39;start_location&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;trip_start_date_time&#39;</span><span class=p>:</span> <span class=n>format_document</span><span class=p>(</span><span class=n>document</span><span class=p>,</span> <span class=s1>&#39;trip_start_date_time&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;end_location&#39;</span><span class=p>:</span> <span class=n>format_document</span><span class=p>(</span><span class=n>document</span><span class=p>,</span> <span class=s1>&#39;start_location&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;price&#39;</span><span class=p>:</span> <span class=n>format_document</span><span class=p>(</span><span class=n>document</span><span class=p>,</span> <span class=s1>&#39;price&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;is_published&#39;</span><span class=p>:</span> <span class=n>format_document</span><span class=p>(</span><span class=n>document</span><span class=p>,</span> <span class=s1>&#39;is_published&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>url</span> <span class=o>+</span> <span class=nb>id</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=n>awsauth</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>document_to_insert</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>count</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39; records processed.&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Dynamodb stream into opensearch Exception = &#34;</span><span class=p>,</span><span class=n>err</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=step-3-create-a-lambda-function-for-conducting-trip-searches-within-opensearch>Step-3: Create a Lambda function for conducting trip searches within OpenSearch.<a hidden class=anchor aria-hidden=true href=#step-3-create-a-lambda-function-for-conducting-trip-searches-within-opensearch>#</a></h3><p>The final task involves crafting an additional Lambda function, named &ldquo;search_trip,&rdquo; to execute queries on the OpenSearch trip-index to find the desired trips. <strong>This lambda will be triggered by an <a href="https://aws.amazon.com/pm/appsync/?trk=a0465925-8003-4d68-bc59-c7cd4211829e&sc_channel=ps&ef_id=CjwKCAjw38SoBhB6EiwA8EQVLogGFZk7gkykFn17c-c_35DX0SnkB0ViheooM-z-vm6B3-hZU-GBbxoCKzAQAvD_BwE:G:s&s_kwcid=AL!4422!3!647258140296!p!!g!!appsync!19621397201!145160425389">appsync query</a>.</strong></p><p><strong>In search_trip lambda, we are utilizing <a href=https://opensearch.org/docs/2.5/query-dsl/>Query DSL</a> to perform queries on the &ldquo;trip_index.&rdquo;.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27>27</a>
</span><span class=lnt id=hl-3-28><a class=lnlinks href=#hl-3-28>28</a>
</span><span class=lnt id=hl-3-29><a class=lnlinks href=#hl-3-29>29</a>
</span><span class=lnt id=hl-3-30><a class=lnlinks href=#hl-3-30>30</a>
</span><span class=lnt id=hl-3-31><a class=lnlinks href=#hl-3-31>31</a>
</span><span class=lnt id=hl-3-32><a class=lnlinks href=#hl-3-32>32</a>
</span><span class=lnt id=hl-3-33><a class=lnlinks href=#hl-3-33>33</a>
</span><span class=lnt id=hl-3-34><a class=lnlinks href=#hl-3-34>34</a>
</span><span class=lnt id=hl-3-35><a class=lnlinks href=#hl-3-35>35</a>
</span><span class=lnt id=hl-3-36><a class=lnlinks href=#hl-3-36>36</a>
</span><span class=lnt id=hl-3-37><a class=lnlinks href=#hl-3-37>37</a>
</span><span class=lnt id=hl-3-38><a class=lnlinks href=#hl-3-38>38</a>
</span><span class=lnt id=hl-3-39><a class=lnlinks href=#hl-3-39>39</a>
</span><span class=lnt id=hl-3-40><a class=lnlinks href=#hl-3-40>40</a>
</span><span class=lnt id=hl-3-41><a class=lnlinks href=#hl-3-41>41</a>
</span><span class=lnt id=hl-3-42><a class=lnlinks href=#hl-3-42>42</a>
</span><span class=lnt id=hl-3-43><a class=lnlinks href=#hl-3-43>43</a>
</span><span class=lnt id=hl-3-44><a class=lnlinks href=#hl-3-44>44</a>
</span><span class=lnt id=hl-3-45><a class=lnlinks href=#hl-3-45>45</a>
</span><span class=lnt id=hl-3-46><a class=lnlinks href=#hl-3-46>46</a>
</span><span class=lnt id=hl-3-47><a class=lnlinks href=#hl-3-47>47</a>
</span><span class=lnt id=hl-3-48><a class=lnlinks href=#hl-3-48>48</a>
</span><span class=lnt id=hl-3-49><a class=lnlinks href=#hl-3-49>49</a>
</span><span class=lnt id=hl-3-50><a class=lnlinks href=#hl-3-50>50</a>
</span><span class=lnt id=hl-3-51><a class=lnlinks href=#hl-3-51>51</a>
</span><span class=lnt id=hl-3-52><a class=lnlinks href=#hl-3-52>52</a>
</span><span class=lnt id=hl-3-53><a class=lnlinks href=#hl-3-53>53</a>
</span><span class=lnt id=hl-3-54><a class=lnlinks href=#hl-3-54>54</a>
</span><span class=lnt id=hl-3-55><a class=lnlinks href=#hl-3-55>55</a>
</span><span class=lnt id=hl-3-56><a class=lnlinks href=#hl-3-56>56</a>
</span><span class=lnt id=hl-3-57><a class=lnlinks href=#hl-3-57>57</a>
</span><span class=lnt id=hl-3-58><a class=lnlinks href=#hl-3-58>58</a>
</span><span class=lnt id=hl-3-59><a class=lnlinks href=#hl-3-59>59</a>
</span><span class=lnt id=hl-3-60><a class=lnlinks href=#hl-3-60>60</a>
</span><span class=lnt id=hl-3-61><a class=lnlinks href=#hl-3-61>61</a>
</span><span class=lnt id=hl-3-62><a class=lnlinks href=#hl-3-62>62</a>
</span><span class=lnt id=hl-3-63><a class=lnlinks href=#hl-3-63>63</a>
</span><span class=lnt id=hl-3-64><a class=lnlinks href=#hl-3-64>64</a>
</span><span class=lnt id=hl-3-65><a class=lnlinks href=#hl-3-65>65</a>
</span><span class=lnt id=hl-3-66><a class=lnlinks href=#hl-3-66>66</a>
</span><span class=lnt id=hl-3-67><a class=lnlinks href=#hl-3-67>67</a>
</span><span class=lnt id=hl-3-68><a class=lnlinks href=#hl-3-68>68</a>
</span><span class=lnt id=hl-3-69><a class=lnlinks href=#hl-3-69>69</a>
</span><span class=lnt id=hl-3-70><a class=lnlinks href=#hl-3-70>70</a>
</span><span class=lnt id=hl-3-71><a class=lnlinks href=#hl-3-71>71</a>
</span><span class=lnt id=hl-3-72><a class=lnlinks href=#hl-3-72>72</a>
</span><span class=lnt id=hl-3-73><a class=lnlinks href=#hl-3-73>73</a>
</span><span class=lnt id=hl-3-74><a class=lnlinks href=#hl-3-74>74</a>
</span><span class=lnt id=hl-3-75><a class=lnlinks href=#hl-3-75>75</a>
</span><span class=lnt id=hl-3-76><a class=lnlinks href=#hl-3-76>76</a>
</span><span class=lnt id=hl-3-77><a class=lnlinks href=#hl-3-77>77</a>
</span><span class=lnt id=hl-3-78><a class=lnlinks href=#hl-3-78>78</a>
</span><span class=lnt id=hl-3-79><a class=lnlinks href=#hl-3-79>79</a>
</span><span class=lnt id=hl-3-80><a class=lnlinks href=#hl-3-80>80</a>
</span><span class=lnt id=hl-3-81><a class=lnlinks href=#hl-3-81>81</a>
</span><span class=lnt id=hl-3-82><a class=lnlinks href=#hl-3-82>82</a>
</span><span class=lnt id=hl-3-83><a class=lnlinks href=#hl-3-83>83</a>
</span><span class=lnt id=hl-3-84><a class=lnlinks href=#hl-3-84>84</a>
</span><span class=lnt id=hl-3-85><a class=lnlinks href=#hl-3-85>85</a>
</span><span class=lnt id=hl-3-86><a class=lnlinks href=#hl-3-86>86</a>
</span><span class=lnt id=hl-3-87><a class=lnlinks href=#hl-3-87>87</a>
</span><span class=lnt id=hl-3-88><a class=lnlinks href=#hl-3-88>88</a>
</span><span class=lnt id=hl-3-89><a class=lnlinks href=#hl-3-89>89</a>
</span><span class=lnt id=hl-3-90><a class=lnlinks href=#hl-3-90>90</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>boto3.dynamodb.conditions</span> <span class=kn>import</span> <span class=n>Key</span><span class=p>,</span> <span class=n>Attr</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>requests_aws4auth</span> <span class=kn>import</span> <span class=n>AWS4Auth</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>INDEX</span> <span class=o>=</span> <span class=s1>&#39;trip_index&#39;</span>
</span></span><span class=line><span class=cl><span class=n>OPENSEARCH_ENDPOINT</span> <span class=o>=</span> <span class=s1>&#39;Endpoint provided by opensearch&#39;</span>
</span></span><span class=line><span class=cl><span class=n>REGION</span> <span class=o>=</span> <span class=s1>&#39;eu-east-1&#39;</span>
</span></span><span class=line><span class=cl><span class=n>SERVICE</span> <span class=o>=</span> <span class=s1>&#39;aoss&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>lambda_handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>credentials</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span><span class=o>.</span><span class=n>get_credentials</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>awsauth</span> <span class=o>=</span> <span class=n>AWS4Auth</span><span class=p>(</span><span class=n>credentials</span><span class=o>.</span><span class=n>access_key</span><span class=p>,</span> <span class=n>credentials</span><span class=o>.</span><span class=n>secret_key</span><span class=p>,</span> <span class=n>REGION</span><span class=p>,</span> <span class=n>SERVICE</span><span class=p>,</span> <span class=n>session_token</span><span class=o>=</span><span class=n>credentials</span><span class=o>.</span><span class=n>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>search_url</span> <span class=o>=</span> <span class=n>OPENSEARCH_ENDPOINT</span> <span class=o>+</span> <span class=s1>&#39;/&#39;</span> <span class=o>+</span> <span class=n>INDEX</span> <span class=o>+</span> <span class=s1>&#39;/_search&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>search_query</span><span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;arguments&#39;</span><span class=p>][</span><span class=s1>&#39;input&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>query_string</span><span class=o>=</span> <span class=n>search_query</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;query_string&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>from_date</span><span class=o>=</span> <span class=n>search_query</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;from_date&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>to_date</span><span class=o>=</span> <span class=n>search_query</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;to_date&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>page</span><span class=o>=</span> <span class=n>search_query</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;page&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>limit</span><span class=o>=</span> <span class=n>search_query</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;limit&#39;</span><span class=p>,</span> <span class=mi>25</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>        <span class=n>start</span> <span class=o>=</span> <span class=p>(</span><span class=n>page</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>limit</span>
</span></span><span class=line><span class=cl>        <span class=n>trip_to_retrieve</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>limit</span> <span class=o>&gt;</span> <span class=mi>100</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s1>&#39;Limit Can not be more than 100 !&#39;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>query</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;from&#34;</span><span class=p>:</span> <span class=n>start</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;size&#34;</span><span class=p>:</span> <span class=n>limit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;query&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;bool&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                       <span class=s2>&#34;must&#34;</span><span class=p>:[</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;match&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                                    <span class=s2>&#34;is_published&#34;</span><span class=p>:</span><span class=n>true</span>
</span></span><span class=line><span class=cl>                                <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=p>},</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;multi_match&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                                    <span class=s2>&#34;query&#34;</span><span class=p>:</span><span class=n>query_string</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                    <span class=s2>&#34;fields&#34;</span><span class=p>:[</span>
</span></span><span class=line><span class=cl>                                    <span class=s2>&#34;id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                    <span class=s2>&#34;trip_name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                    <span class=s2>&#34;strat_location&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                    <span class=s2>&#34;end_location&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                    <span class=s2>&#34;price&#34;</span>
</span></span><span class=line><span class=cl>                                    <span class=p>]</span>
</span></span><span class=line><span class=cl>                                <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=p>},</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;range&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                                    <span class=s2>&#34;trip_start_date_time&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                                        <span class=s2>&#34;gte&#34;</span><span class=p>:</span> <span class=n>from_date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                        <span class=s2>&#34;lte&#34;</span><span class=p>:</span> <span class=n>to_date</span>
</span></span><span class=line><span class=cl>                                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                                <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                       <span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;sort&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;trip_start_date_time&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;order&#34;</span><span class=p>:</span> <span class=s2>&#34;desc&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                 <span class=p>]</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Make the signed HTTP request</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>search_url</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=n>awsauth</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>query</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>search_result</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>total</span><span class=o>=</span> <span class=n>search_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;hits&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;total&#39;</span><span class=p>)[</span><span class=s1>&#39;value&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>total</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>items</span> <span class=o>=</span> <span class=n>search_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;hits&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;hits&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>search_response</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;total&#39;</span><span class=p>:</span> <span class=n>search_result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;hits&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;total&#39;</span><span class=p>)[</span><span class=s1>&#39;value&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;items&#39;</span><span class=p>:</span> <span class=n>items</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>search_response</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Search Trip Exception = &#34;</span><span class=p>,</span><span class=n>err</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>With Query DSL, we have the capability to incorporate pagination through the &ldquo;from&rdquo; and &ldquo;size&rdquo; properties, arrange data in both ascending and descending orders using the &ldquo;sort&rdquo; property, and perform queries within a specified date range using the &ldquo;range&rdquo; property.</p><p><strong>And last but not the least, it&rsquo;s essential to remember that you should include the &ldquo;ddb_stream_to_es&rdquo; and &ldquo;search_trip&rdquo; lambda roles, as well as your IAM user role, in the OpenSearch data access policy to enable access and perform CRUD (Create, Read, Update, Delete) operations on indexes within the specified collection.</strong></p><h3 id=thank-you-for-your-patience-i-hope-you-found-this-article-useful-happy-reading><em>Thank you for your patience!! I hope you found this article useful. Happy reading!</em><a hidden class=anchor aria-hidden=true href=#thank-you-for-your-patience-i-hope-you-found-this-article-useful-happy-reading>#</a></h3></div><footer class=post-footer><ul class=post-tags><li><a href=https://Nabila-Farzana.github.io/ThevinchisNotebook/tags/aws/>AWS</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://Nabila-Farzana.github.io/ThevinchisNotebook/>A chitchat about new learnings</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>